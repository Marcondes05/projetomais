{% extends "base.html" %}
{% block title %}Editar Projeto{% endblock %}

{% block content %}
<div class="pagina-central">

    <div class="form-card form-projeto">

        <h1 class="form-title">Editar Projeto</h1>

        <form method="POST" action="{{ url_for('project.atualizar_projeto', project_id=projeto.id) }}">

            <!-- TÍTULO -->
            <label class="label">Título</label>
            <input type="text" name="titulo" value="{{ projeto.titulo }}" class="input-field" required>

            <!-- RESUMO -->
            <label class="label">Resumo</label>
            <textarea name="resumo" rows="4" class="input-field" required>{{ projeto.resumo }}</textarea>

            <!-- TIPO -->
            <label class="label">Tipo</label>
            <select name="tipo" class="input-field">
                <option {% if projeto.tipo == "Pesquisa" %}selected{% endif %}>Pesquisa</option>
                <option {% if projeto.tipo == "Ensino" %}selected{% endif %}>Ensino</option>
                <option {% if projeto.tipo == "Extensão" %}selected{% endif %}>Extensão</option>
            </select>

            <!-- EDITAL -->
            <label class="label">Edital</label>
            <input type="text" name="edital" value="{{ projeto.edital }}" class="input-field">

            <!-- ANO -->
            <label class="label">Ano</label>
            <input type="number" name="ano" value="{{ projeto.ano }}" class="input-field" required>

            <!-- FINANCIADOR -->
            <label class="label">Financiador</label>
            <input type="text" name="financiador" value="{{ projeto.financiador }}" class="input-field">

            <!-- ORIENTADOR -->
            <label class="label">Orientador</label>
            <div class="autocomplete-wrapper">
                <input id="input-orientador" class="input-field" autocomplete="off" placeholder="Buscar orientador...">
                <div id="orientador_autocomplete" class="autocomplete-box"></div>
            </div>

            <input type="hidden" id="orientador_id" name="orientador_id" value="{{ projeto.orientador.id }}">

            <div id="orientador_badges" class="badge-box">
                <span class="badge-item" data-id="{{ projeto.orientador.id }}">
                    {{ projeto.orientador.nome }}
                    <button type="button" class="badge-remove">x</button>
                </span>
            </div>

            <!-- ESTUDANTES -->
            <label class="label">Estudantes</label>
            <div class="autocomplete-wrapper">
                <input id="input-estudantes" class="input-field" autocomplete="off" placeholder="Buscar estudantes...">
                <div id="estudantes_autocomplete" class="autocomplete-box"></div>
            </div>

            <input type="hidden" id="estudantes_ids" name="estudantes_ids"
                   value="{{ projeto.estudantes | map(attribute='id') | join(',') }}">

            <div id="estudantes_badges" class="badge-box">
                {% for e in projeto.estudantes %}
                <span class="badge-item" data-id="{{ e.id }}">
                    {{ e.nome }}
                    <button type="button" class="badge-remove">x</button>
                </span>
                {% endfor %}
            </div>

            <!-- COORIENTADORES -->
            <label class="label">Coorientadores</label>
            <div class="autocomplete-wrapper">
                <input id="input-coorientadores" class="input-field" autocomplete="off" placeholder="Buscar coorientadores...">
                <div id="coorientadores_autocomplete" class="autocomplete-box"></div>
            </div>

            <input type="hidden" id="coorientadores_ids" name="coorientadores_ids"
                   value="{{ projeto.coorientadores | map(attribute='id') | join(',') }}">

            <div id="coor_badges" class="badge-box">
                {% for c in projeto.coorientadores %}
                <span class="badge-item" data-id="{{ c.id }}">
                    {{ c.nome }}
                    <button type="button" class="badge-remove">x</button>
                </span>
                {% endfor %}
            </div>

            <button class="btn-primary" type="submit">Salvar Alterações</button>

        </form>

    </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

    App.setupAutocomplete("input-orientador", "orientador_id", "orientador_badges", {
        single: true,
        box: "orientador_autocomplete"
    });

    App.setupAutocomplete("input-estudantes", "estudantes_ids", "estudantes_badges", {
        single: false,
        box: "estudantes_autocomplete"
    });

    App.setupAutocomplete("input-coorientadores", "coorientadores_ids", "coor_badges", {
        single: false,
        box: "coorientadores_autocomplete"
    });

});
</script>

{% endblock %}
